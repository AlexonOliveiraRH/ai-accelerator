- op: add
  path: /spec/resourceHealthChecks/-
  value:
    group: serving.kserve.io
    kind: InferenceService
    check: |
      health_status = {}
      if obj.status ~= nil then
        if obj.status.conditions ~= nil then
          msg = ""
          progressing = false
          degraded = false
          for i, condition in pairs(obj.status.conditions) do

            if condition.message == nil then
              message = ""
            else
              message = condition.message
            end

            if condition.status == "Unknown" then
              progressing = true

              msg = msg .. i .. ": " .. condition.type .. " | " .. condition.status .. " | " .. condition.reason .. " | " .. message .. "\n"
            elseif condition.status == "False" then
              if condition.type == "LatestDeploymentReady" then
                progressing = true
              else
                degraded = true
              end
              msg = msg .. i .. ": " .. condition.type .. " | " .. condition.status .. " | " .. condition.reason .. " | " .. message .. "\n"
            end

          end

          if progressing == false and degraded == false then
            health_status.status = "Healthy"
          elseif progressing == true then
            health_status.status = "Progressing"
          elseif degraded == true then
            health_status.status = "Degraded"
          end

          health_status.message = msg
        else
          health_status.status = "Progressing"
          health_status.message = "InferenceService is creating..."
        end
      else
        health_status.status = "Progressing"
        health_status.message = "Waiting for InferenceService to report status..."
      end

      return health_status
